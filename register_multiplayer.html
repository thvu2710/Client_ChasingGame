<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>collapsible demo</title>
	<link rel="stylesheet" href="jquery.mobile-1.4.2.min.css">
	<!-- css files -->
	<link rel="stylesheet" href="index.css">
	<link rel="stylesheet" href="info.css">
	<link rel="stylesheet" href="home.css">
	<link rel="stylesheet" href="countdown_timer.css">
	
	<script src="jquery-1.10.2.min.js"></script>
	<script src="jquery.mobile-1.4.2.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="cordova-1.5.0.js"></script>
</head>
<body>
<div data-role="page" id="page1">
	<div data-role="header">
		<h1>Mistake Chasing Game</h1>
		<a href=home.html data-role=button class="ui-btn-left" data-icon=back> Back </a>
	</div>
	<div data-role="content">
		<div data-role="tabs">
			<div data-role="navbar" data-iconpos="top" >
				<ul>
					<li><a data-icon="check" class="ui-btn-active" href="#john_a_room" id="getAvailableRooom">Register to a room</a></li>
					<li><a data-icon="plus" href="#create_new_room">Create new room</a></li>
				</ul>
			</div>
			<div id="john_a_room">
				<ol data-role="listview" data-inset="true">
					
				</ol>
			</div>
			<div id="create_new_room">
			<p class="text" style="padding-left: 40px; text-align: left">Type the name of your room:<br />
				<input type=text placeholder="Name of room" id="tfName">
			</p>
			<p class="text" style="padding-left: 40px; text-align: left">Max player in room:<br />
				<input type=text placeholder="Max player of room" id="tfMax">
			</p>
			
			<a href=# data-role=button id=btn_create_room> Create Room </a>
			</div>
		</div>
	</div>
	<script>
		$("#btn_create_room").bind ("click", function (event)
		{
			if ($("#tfName").val().length == 0 || $("#tfMax").val().length == 0) {
				alert("Room name or Max Player must not be empty!");
				return;
			}
			var room_info = {
				email:sessionStorage.getItem("email"),
				tfName: $("#tfName").val(),
				tfMax:$("#tfMax").val()
			};
			
			$.ajax({
				 url:"mistake-chasinggame.rhcloud.com/rest/webservice/create_room",
				 dataType: 'jsonp',
				 data: room_info,
				 success: function(json){
					if (json.statusCode == 1) {
						$.mobile.changePage ("#error_infor");
					 } else if(json.statusCode == 2){
						$.mobile.changePage ("#success_infor");
					 }
				 },
				 error:function(){
					 alert("Error");
				 }      
			});
		});
		
		$("#getAvailableRooom").bind ("click", function (event)
		{
			getAvailableRoom();
		});
		
		function getAvailableRoom() {
			$.ajax({
				 url:"http://mistake-chasinggame.rhcloud.com/rest/webservice/available_room",
				 dataType: 'jsonp',
				 success: function(json){
					$("ol").text("");
					for (var i = 0; i < json.parameters.length; i++) {
						var current_room = json.parameters[i];
						//var id = current_room.id;
						var room_name = current_room.room_name;
						var user_created = current_room.user_created;
						var time_created = current_room.time_created;
						//var max_of_register = current_room.max_of_register;
						var register_list = current_room.register_list;
						var total_register = register_list.length;
						$("ol").append("<li><a href=register_info.html?room_name=" + room_name + "&user_created=" + user_created + "&time_created=" + time_created + " rel=external>" + room_name + "<span class=ui-li-count>" + total_register + " registered</span></a></li>");
					}
					$("ol").listview('refresh');
				 },
				 error:function(){
					 alert("Error");
				 }      
			});
		}
		
		//run after enter this page
		getAvailableRoom();
	</script>
	<div data-role=footer data-position="fixed">
		<h1>Mistake Chasing Game (c) 2013</h1>
	</div>
</div>
<div data-role=dialog id=error_infor>
	<div data-role=header  >
		<h1>INFORMATION</h1>
	</div>
	<div data-role=content>
		<p class="text">Room has been created, no need to create newly</p>
	</div>
</div>
<div data-role=dialog id=success_infor>
	<div data-role=header  >
		<h1>INFORMATION</h1>
	</div>
	<div data-role=content>
		<p class="text">Room has been created newly and user has been registered successfully</p>
	</div>
</div>
</body>
</html>