<!-- Copyright (c) 2012 Mobile Developer Solutions -->
<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-type" name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=device-width">
	<title>MDS PhoneGap API Demo with jQuery Mobile</title>

	<link rel="stylesheet" href="jquery.mobile-1.4.2.min.css">
	<script src="jquery-1.10.2.min.js"></script>
	<script src="jquery.mobile-1.4.2.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="cordova-1.5.0.js"></script>
	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
	<style type=text/css>
		/* style for text */
		.text {
			color: #000000;
			text-shadow: 0px -1px 1px rgba(0, 0, 0, 0.7);
			padding: 13px 20px;
			font-size: 19px;
			margin: 0px auto;
			text-align: center;
		}
		
		body {
			background-color: "#f0eff6";
		}
		.rightMenu {
			position: absolute;
			top:-10%;   
			right:-2%;
			width: 100px !important;
		}

		.rightMenu .ui-collapsible-content .ui-listview {
			margin: -10px -15px -10px -35px !important;
		}
		.horizontalRule {
			min-height: 1px;
			clear:both; width:100%;
			border-bottom:1px solid #d1d1d1;
			height:1px; 
			padding-top:2px;
			margin-bottom:10px;
		}
		
		table{
			border:none;
			border-spacing:25px 8px;
		}
		
		#rrr{
			font: normal 12px 'Open Sans', sans-serif;
			margin-top: 20px;
		}
		ul.countdown {
			list-style: none;
			margin: 15px 0;
			padding: 0;
			display: block;
			text-align: center;
		}
		ul.countdown li {
			display: inline-block;
		}
		ul.countdown li span {
			font-size: 50px;
			font-weight: 300;
			line-height: 80px;
		}
		ul.countdown li.seperator {
			font-size: 80px;
			line-height: 70px;
			vertical-align: top;
		}
		ul.countdown li p {
			color: #a7abb1;
			font-size: 14px;
		}

	</style>
</head>
<body>
	<div data-role=page id=index>
		<div data-role=header >
			<h1>Mistake Chasing Game</h1>
			<a href=info.html rel=external data-role=button class="ui-btn-right" data-icon=info> Info </a>
			<a href=# data-role=button class="ui-btn-left" data-icon=back id="exit"> Exit </a>
		</div>
		<div data-role=content>
			<p class="text">SIGN IN TO YOUR ACCOUNT</p>
			<p>
				<input type=text placeholder="Enter Email" id="tfEmail">
			</p>
			<p>
				<input type=password placeholder="Enter Password" id="pfPassword">
			</p>
			<p>
				<a href=# data-role=button data-theme=e data-icon=check id=signin> SIGN IN
				</a>
			</p>
			<p class="text" style="font-size: 15px;"><a href="reset_password.html" style="text-decoration: none; color: #d10000;" >Forgot
				Password?</a></p>
			<p>
				<a href=signup.html rel=external data-role=button data-icon=plus> SIGN UP NEW ACCOUNT </a>
			</p>
		</div>
		<div data-role=footer  data-position="fixed">
			<h1>Mistake Chasing Game (c) 2013</h1>
		</div>
	</div>
</body>
<script>
	function parse(val) {
		var result = "Not found",
			tmp = [];
		location.search
		//.replace ( "?", "" ) 
		// this is better, there might be a question mark inside
		.substr(1)
			.split("&")
			.forEach(function (item) {
			tmp = item.split("=");
			if (tmp[0] === val) result = decodeURIComponent(tmp[1]);
		});
		return result;
	}
	
	if (parse('email') != "Not found" && parse('password') != "Not found") {
		$("#tfEmail").val(parse('email'));
		$("#pfPassword").val(parse('password'));
	}
//document.addEventListener("deviceReady", deviceReady, false);

//function deviceReady() {
	$("#exit").bind ("click", function (event)
			{
			  navigator.app.exitApp();
			});
			
			$("#signin").bind ("click", function (event)
			{
			
				if ($("#tfEmail").val().length == 0 || $("#pfPassword").val().length == 0) {
					alert("Email or password must not be empty");
					return;
				}
				var user_info = {
					email: $("#tfEmail").val(),
			        password:$("#pfPassword").val()
				};
				
				$.ajax({
					 url:"http://localhost:8080/FirstRestWS/rest/webservice/login",
					 dataType: 'json',
					 type: "POST",
					 crossDomain: true,
					 data: user_info,
					 success: function(json){
						 if (json.message == "true") {
							 sessionStorage.setItem("email", $("#tfEmail").val());
							 sessionStorage.setItem("password", $("#pfPassword").val());
							 //$.mobile.changePage ("home.html");
							 window.location = "home.html"
						 } else {
							 alert("Email, password is not correct or your account is being used by another one");
						 }
					 },
					 error:function(){
						 alert("Error");
					 }      
				});
			});
//}
	
</script>
</html>
