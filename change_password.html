<div data-role=page id=home>
	<div data-role=header  data-add-back-btn=true>
		<h1>Mistake Chasing Game</h1>
	</div>
	<div data-role=content>
		<p class="text">CHANGE YOUR PASSWORD</p>
		<p>
			<input type=text placeholder="Enter Old Password" id="old_passwd">
			<input type=password placeholder="Enter New Password" id="new_passwd">
			<input type=password placeholder="Repeat New Password" id="repeat_new_passwd">
		</p>
		<p>
			<a href=# data-role=button data-icon=refresh data-theme=e id="apply_change"> APPLY PASSWORD CHANGING </a>
		</p>
	</div>
	<div data-role=footer  data-position="fixed">
		<h1>Mistake Chasing Game (c) 2013</h1>
	</div>
	
	<script>
		$("#apply_change").bind ("click", function (event)
		{
		
		if ($("#old_passwd").val().length == 0 || $("#new_passwd").val().length == 0 || $("#repeat_new_passwd").val().length == 0) {
			alert("Old Password, New Password or Repeat New Password must not be empty!");
			return;
		} else {
			if ($("#new_passwd").val() != $("#repeat_new_passwd").val()) {
				alert("New Password and Repeat New Password must be the same as each others!");
				return;
			} else {
				request_change_password();
			}
		}
		
		function request_change_password() {
			var user_info = {
				email: sessionStorage.getItem("email"),
				old_passwd: $("#old_passwd").val(),
				new_passwd:$("#new_passwd").val()
			};
		
			$.ajax({
				 url:"http://127.0.0.1:81/Game/change_password.php",
				 dataType: 'jsonp',
				 data: user_info,
				 success: function(json){
					if (json.success == 0) {
						alert("Your old password is not correct!");
					} else {
						alert("Your new password has changed!");
						$.mobile.changePage ("home.html");
					}
				 },
				 error:function(){
					 alert("Error");
				 }      
			});
		}
	});
	</script>
	
</div>
